---
layout: default
---

<div class="post-wrapper">
  <article class="post-content">
    {{ content }}
  </article>
  
  <aside class="toc-sidebar" id="toc-sidebar">
    <div class="toc-header">
      <h4>Table of Contents</h4>
    </div>
    <nav class="toc-nav" id="toc-nav">
      <!-- TOC will be generated by JavaScript -->
    </nav>
  </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const postContent = document.querySelector('.post-content');
  const tocNav = document.getElementById('toc-nav');
  
  if (!postContent || !tocNav) return;
  
  // Remove the inline TOC generated by Kramdown (the first ul after "* TOC {:toc}")
  const inlineToc = postContent.querySelector('#markdown-toc');
  if (inlineToc) {
    inlineToc.remove();
  }
  
  // Also remove any ul that's at the very beginning (kramdown TOC)
  const firstChild = postContent.firstElementChild;
  if (firstChild && firstChild.tagName === 'UL' && firstChild.querySelector('a[href^="#"]')) {
    const links = firstChild.querySelectorAll('a');
    const isAllAnchors = Array.from(links).every(a => a.getAttribute('href')?.startsWith('#'));
    if (isAllAnchors && links.length > 0) {
      firstChild.remove();
    }
  }
  
  // Get all headings
  const headings = postContent.querySelectorAll('h1, h2, h3, h4');
  
  if (headings.length === 0) {
    document.getElementById('toc-sidebar').style.display = 'none';
    return;
  }
  
  const tocList = document.createElement('ul');
  tocList.className = 'toc-list';
  
  headings.forEach((heading, index) => {
    // Ensure heading has an id
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }
    
    const li = document.createElement('li');
    li.className = 'toc-item toc-' + heading.tagName.toLowerCase();
    
    const a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;
    a.className = 'toc-link';
    
    // Smooth scroll
    a.addEventListener('click', function(e) {
      e.preventDefault();
      heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
      history.pushState(null, '', '#' + heading.id);
    });
    
    li.appendChild(a);
    tocList.appendChild(li);
  });
  
  tocNav.appendChild(tocList);
  
  // Highlight current section on scroll
  const observerOptions = {
    rootMargin: '-80px 0px -80% 0px',
    threshold: 0
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const id = entry.target.id;
      const tocLink = tocNav.querySelector(`a[href="#${id}"]`);
      if (tocLink) {
        if (entry.isIntersecting) {
          tocNav.querySelectorAll('.toc-link').forEach(link => link.classList.remove('active'));
          tocLink.classList.add('active');
        }
      }
    });
  }, observerOptions);
  
  headings.forEach(heading => observer.observe(heading));
});
</script>